
> hockey-app@2.1.0 test:coverage
> vitest run --coverage


[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90m/data/.openclaw/workspace/hockey-app[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2mgenerates and stores a magic link token
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2maccepts valid email formats
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2msends email to correct address
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2mincludes magic link in email
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2muses BASE_URL from environment
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2muses default BASE_URL if not set
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2mincludes token expiry info in email
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2mstores token with expiry time
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2mhandles email sending errors
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2mcleans up expired tokens
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.
GMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2mallows multiple tokens to be issued
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2muses GMAIL_USER from environment
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequestMagicLink[2m > [22m[2muses default GMAIL_USER if not set
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mverifyMagicLink[2m > [22m[2mreturns JWT token for valid magic link
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mverifyMagicLink[2m > [22m[2mreturns JWT with admin role
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mverifyMagicLink[2m > [22m[2minvalidates token after single use
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mverifyMagicLink[2m > [22m[2mrejects expired tokens
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mverifyMagicLink[2m > [22m[2mincludes email in returned JWT
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mverifyJWT[2m > [22m[2mverifies valid JWT token
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mverifyJWT[2m > [22m[2mrejects tampered JWT
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mverifyJWT[2m > [22m[2mrejects expired JWT
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mverifyJWT[2m > [22m[2mdecodes token without verification when valid
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mverifyJWT[2m > [22m[2muses default JWT_SECRET if not set
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequireAuth[2m > [22m[2mextracts and verifies JWT from Bearer token
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequireAuth[2m > [22m[2muses authorisation header (British spelling)
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequireAuth[2m > [22m[2mrejects request with missing Bearer prefix
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequireAuth[2m > [22m[2mrejects request with expired JWT
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequireAuth[2m > [22m[2mhandles case-insensitive authorization header
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

[90mstderr[2m | test/server/auth.test.mjs[2m > [22m[2mauth.mjs[2m > [22m[2mrequireAuth[2m > [22m[2mreturns decoded JWT payload
[22m[39mGMAIL_APP_PASSWORD not set. Email sending will fail.

 [31m‚ùØ[39m test/server/auth.test.mjs [2m([22m[2m43 tests[22m[2m | [22m[31m29 failed[39m[2m)[22m[32m 177[2mms[22m[39m
[31m       [31m√ó[31m generates and stores a magic link token[39m[32m 48[2mms[22m[39m
       [32m‚úì[39m rejects empty email[32m 6[2mms[22m[39m
       [32m‚úì[39m rejects null email[32m 0[2mms[22m[39m
       [32m‚úì[39m rejects undefined email[32m 0[2mms[22m[39m
       [32m‚úì[39m rejects email without @ symbol[32m 4[2mms[22m[39m
[31m       [31m√ó[31m accepts valid email formats[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m sends email to correct address[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m includes magic link in email[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m uses BASE_URL from environment[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m uses default BASE_URL if not set[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m includes token expiry info in email[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m stores token with expiry time[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m handles email sending errors[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m cleans up expired tokens[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m allows multiple tokens to be issued[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m uses GMAIL_USER from environment[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m uses default GMAIL_USER if not set[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m returns JWT token for valid magic link[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m returns JWT with admin role[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m rejects invalid token[32m 6[2mms[22m[39m
       [32m‚úì[39m rejects empty token[32m 0[2mms[22m[39m
       [32m‚úì[39m rejects null token[32m 0[2mms[22m[39m
[31m       [31m√ó[31m invalidates token after single use[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m rejects expired tokens[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m includes email in returned JWT[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m verifies valid JWT token[39m[32m 7[2mms[22m[39m
       [32m‚úì[39m rejects invalid JWT[32m 1[2mms[22m[39m
[31m       [31m√ó[31m rejects tampered JWT[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m rejects expired JWT[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m rejects empty token[32m 0[2mms[22m[39m
       [32m‚úì[39m rejects null token[32m 0[2mms[22m[39m
[31m       [31m√ó[31m decodes token without verification when valid[39m[32m 8[2mms[22m[39m
       [32m‚úì[39m uses JWT_SECRET from environment[32m 1[2mms[22m[39m
[31m       [31m√ó[31m uses default JWT_SECRET if not set[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m extracts and verifies JWT from Bearer token[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m uses authorisation header (British spelling)[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m rejects request without authorization header[32m 4[2mms[22m[39m
[31m       [31m√ó[31m rejects request with missing Bearer prefix[39m[32m 3[2mms[22m[39m
       [32m‚úì[39m rejects request with invalid Bearer format[32m 0[2mms[22m[39m
       [32m‚úì[39m rejects request with invalid JWT token[32m 3[2mms[22m[39m
[31m       [31m√ó[31m rejects request with expired JWT[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m handles case-insensitive authorization header[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m returns decoded JWT payload[39m[32m 10[2mms[22m[39m
[90mstderr[2m | src/context/TournamentContext.test.jsx[2m > [22m[2mTournamentContext[2m > [22m[2mprovides initial values
[22m[39mTournamentContext init { url: [32m'http://localhost/api/tournaments'[39m }

[90mstderr[2m | src/context/TournamentContext.test.jsx[2m > [22m[2mTournamentContext[2m > [22m[2mprovides initial values
[22m[39mAn update to TournamentProvider inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TournamentProvider inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TournamentProvider inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | src/context/TournamentContext.test.jsx[2m > [22m[2mTournamentContext[2m > [22m[2muses localStorage to persist active tournament
[22m[39mTournamentContext init { url: [32m'http://localhost/api/tournaments'[39m }

[90mstderr[2m | src/context/TournamentContext.test.jsx[2m > [22m[2mTournamentContext[2m > [22m[2mhandles API errors gracefully
[22m[39mTournamentContext init { url: [32m'http://localhost/api/tournaments'[39m }

[90mstderr[2m | src/context/TournamentContext.test.jsx[2m > [22m[2mTournamentContext[2m > [22m[2mhandles empty tournaments list
[22m[39mTournamentContext init { url: [32m'http://localhost/api/tournaments'[39m }

[90mstderr[2m | src/context/TournamentContext.test.jsx[2m > [22m[2mTournamentContext[2m > [22m[2mmemoizes activeTournament to prevent unnecessary recalculations
[22m[39mTournamentContext init { url: [32m'http://localhost/api/tournaments'[39m }

[90mstderr[2m | src/context/TournamentContext.test.jsx[2m > [22m[2mTournamentContext[2m > [22m[2mdisables context when tournaments endpoint is unavailable
[22m[39mTournamentContext init { url: [1mnull[22m }

[90mstderr[2m | src/context/TournamentContext.test.jsx[2m > [22m[2mTournamentContext[2m > [22m[2mupdates activeTournament when activeTournamentId changes
[22m[39mTournamentContext init { url: [32m'http://localhost/api/tournaments'[39m }

 [31m‚ùØ[39m src/context/TournamentContext.test.jsx [2m([22m[2m7 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 6197[2mms[22m[39m
[31m     [31m√ó[31m provides initial values[39m[32m 77[2mms[22m[39m
[31m     [31m√ó[31m uses localStorage to persist active tournament[39m[33m 1019[2mms[22m[39m
[31m     [31m√ó[31m handles API errors gracefully[39m[33m 1009[2mms[22m[39m
[31m     [31m√ó[31m handles empty tournaments list[39m[33m 1007[2mms[22m[39m
[31m     [31m√ó[31m memoizes activeTournament to prevent unnecessary recalculations[39m[33m 1021[2mms[22m[39m
[31m     [31m√ó[31m disables context when tournaments endpoint is unavailable[39m[33m 1034[2mms[22m[39m
[31m     [31m√ó[31m updates activeTournament when activeTournamentId changes[39m[33m 1029[2mms[22m[39m
 [31m‚ùØ[39m src/views/admin/LoginPage.test.jsx [2m([22m[2m8 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 3166[2mms[22m[39m
     [32m‚úì[39m renders login form initially[32m 169[2mms[22m[39m
     [32m‚úì[39m renders input field with correct placeholder[32m 17[2mms[22m[39m
     [32m‚úì[39m updates email state on input change[32m 37[2mms[22m[39m
     [33m[2m‚úì[22m[39m submits form with email [33m 591[2mms[22m[39m
     [32m‚úì[39m shows success message after successful submission[32m 107[2mms[22m[39m
[31m     [31m√ó[31m shows error when fetch fails[39m[33m 1120[2mms[22m[39m
[31m     [31m√ó[31m handles network errors gracefully[39m[33m 1057[2mms[22m[39m
     [32m‚úì[39m displays helpful text in success message[32m 65[2mms[22m[39m
